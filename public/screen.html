<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Game Screen</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin: 0; background: #111; }
    canvas { display: block; margin: 0 auto; background: #222; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="480"></canvas>
  <script>
    const socket = io();
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    let map = null;
    let teams = {};
    let winner = null;

    socket.on('init', data => {
      map = data.map;
      teams = data.teams;
      draw();
    });

    socket.on('state', state => {
      map = state.map;
      teams = state.teams;
      winner = state.winner;
      draw();
    });

    socket.on('reset', state => {
      map = state.map;
      teams = state.teams;
      winner = null;
      draw();
    });

    function draw() {
      if (!map) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const cellW = canvas.width / map.width;
      const cellH = canvas.height / map.height;

      // background grid
      ctx.strokeStyle = '#444';
      for (let x = 0; x <= map.width; x++) {
        ctx.beginPath();
        ctx.moveTo(x * cellW, 0);
        ctx.lineTo(x * cellW, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= map.height; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * cellH);
        ctx.lineTo(canvas.width, y * cellH);
        ctx.stroke();
      }
            // walls
      if (map.walls) {
        ctx.fillStyle = '#555';
        map.walls.forEach(w => {
          ctx.fillRect(
            w.x * cellW,
            w.y * cellH,
            cellW,
            cellH
          );
        });
      }
      // hole (goal)
      ctx.fillStyle = '#2ecc71';
      ctx.beginPath();
      ctx.arc(
        (map.hole.x + 0.5) * cellW,
        (map.hole.y + 0.5) * cellH,
        Math.min(cellW, cellH) * 0.4,
        0, Math.PI * 2
      );
      ctx.fill();

      // cubes (teams)
      Object.values(teams).forEach(team => {
        ctx.fillStyle = team.color;
        ctx.fillRect(
          team.cube.x * cellW + cellW * 0.1,
          team.cube.y * cellH + cellH * 0.1,
          cellW * 0.8,
          cellH * 0.8
        );
      });

      if (winner) {
        ctx.fillStyle = 'white';
        ctx.font = '40px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(`Winner: ${winner.toUpperCase()}`, canvas.width / 2, 60);
      }
    }
  </script>
</body>
</html>
